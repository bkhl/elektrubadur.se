{{- define "setup" -}}
{{- with .Resources.GetMatch "config.toml" -}}
{{- $.Scratch.Set "config" (. | unmarshal) -}}
{{- end -}}
{{- end -}}

{{ define "site_nav" }}
{{ partial "main_menu" . }}
{{ end }}

{{ define "main" }}
<article>
  <header>
    <h1>{{ .Page.Title }}</h1>
    {{ if eq .Page.Section "" }}
    {{ partial "dateline" (dict "Page" .Page "Context" "single") }}
    {{ end }}
  </header>
  {{ partial "featured_image" (dict "Page" . "context" "single") }}
  {{ if and (gt .WordCount 400 ) (.Params.toc) }}
  <aside>
    {{ .TableOfContents }}
  </aside>
  {{ end }}
  {{ .Page.Content | safeHTML }}
  {{ partial "gallery" . }}
</article>
{{ end }}
