<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://elektrubadur.se/style.min.css">
<link href="https://elektrubadur.se/favicon.ico" rel="icon">
<link href="https://elektrubadur.se/favicon-16x16.png" rel="icon" sizes="16x16">
<link href="https://elektrubadur.se/favicon-96x96.png" rel="icon" sizes="96x96">
<link href="https://elektrubadur.se/favicon-192x192.png" rel="icon" sizes="192x192">
<link href="https://elektrubadur.se/favicon-32x32.png" rel="icon" sizes="32x32">
<title>Vimwiki + Nextcloud Notes – Elektrubadur</title>
<link rel="alternate" type="application/rss+xml" href="https://elektrubadur.se/rss.xml" title="Elektrubadur">
<link rel="sitemap" type="application/xml" title="Elektrubadur Sitemap" href="https://elektrubadur.se/sitemap.xml">
<link rel="me" href="https://social.sdfeu.org/@bkhl">
<meta name="description" content="Personal web page of Björn Lindström">
<meta name="author" content="Björn Lindström">
</head>
<body>
<header>
<h2><a href="https://elektrubadur.se/">Elektrubadur</a></h2>
<nav>
<p><a href="https://elektrubadur.se/">Posts</a> — <a href="https://elektrubadur.se/galleries/">Galleries</a> — <a href="https://elektrubadur.se/about_me/">About Me</a> — <a href="https://elektrubadur.se/resume/">Resumé</a> — <a href="https://elektrubadur.se/about_page/">About This Page</a></p>
</nav>
</header>
<main>
<article>
<header>
<h1>Vimwiki + Nextcloud Notes</h1>
<p>By <em>Björn Lindström</em> in <a href="https://elektrubadur.se/categories/programming/">Programming</a> about <a href="https://elektrubadur.se/tags/vim/">Vim</a>, <a href="https://elektrubadur.se/tags/vimwiki/">Vimwiki</a>, <a href="https://elektrubadur.se/tags/nextcloud/">Nextcloud</a> and <a href="https://elektrubadur.se/tags/notes/">Notes</a> —&nbsp;<time datetime="2020-05-02">Saturday&nbsp;May&nbsp;2,&nbsp;2020</time></p>
</header>
<p>I've been using <a href="http://vimwiki.github.io/">Vimwiki</a> for a while, which lets me keep interlinked plain text notes on my computer with minimal hassle.</p>
<p>For a while I've also kept these synced to my phone via the <a href="https://apps.nextcloud.com/apps/notes/">Nextcloud Notes</a> application. I have a self-hosted <a href="https://nextcloud.com/">Nextcloud</a> instance, and simply point Vimwiki on my computer to the same directory in the directory that I have synchronized with Nextcloud.</p>
<p>The Nextcloud Notes app uses Markdown, so I have to configure Vimwiki to use that syntax, which is fine with me. One quirk of the Nextcloud Notes app is that rather than letting you name files independently, it will change filenames to whatever the first line of your note is. Until today that meant I had to keep making sure in Vimwiki to add those headers, but I've now finally automated that.</p>
<p>To start with, I added the function <code class="verbatim">SetWikiHeader</code> to <a href="https://github.com/bkhl/dotfiles/blob/c122d0b5016a9e4cfc29947ff7ecb9741ab4d11e/.vim/plugin/config/vimwiki.vim">my ~/.vim/plugin/config/vim.wiki</a>:</p>
<div class="src src-vim">
<div class="highlight">
<pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span><span style="color:#5317ac">if</span> &amp;runtimepath !~? <span style="color:#2544bb">"vimwiki"</span>
</span></span><span style="display:flex;"><span>  finish
</span></span><span style="display:flex;"><span><span style="color:#5317ac">endif</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">
</span></span></span><span style="display:flex;"><span><span style="color:#505050">" My main wiki.</span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">let</span> g:vimwiki_list = [{
</span></span><span style="display:flex;"><span>            \<span style="color:#2544bb">"path"</span>: <span style="color:#2544bb">"~/Documents/Notes/"</span>,
</span></span><span style="display:flex;"><span>            \<span style="color:#2544bb">"syntax"</span>: <span style="color:#2544bb">"markdown"</span>, <span style="color:#2544bb">"ext"</span>: <span style="color:#2544bb">".md"</span>
</span></span><span style="display:flex;"><span>            \}]
</span></span><span style="display:flex;"><span><span style="color:#505050">
</span></span></span><span style="display:flex;"><span><span style="color:#505050">" Disable creation of temporary wikis.</span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">let</span> g:vimwiki_global_ext = <span style="color:#0000c0">0</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">
</span></span></span><span style="display:flex;"><span><span style="color:#505050">" Function to set header of current file to match filename.</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">"</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">" This helps interoparability with Nextcloud Notes, which assumes that</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">" the first line of the file matches the filename.</span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">function</span> SetWikiHeader()
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">let</span> first_line = getline(<span style="color:#0000c0">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">let</span> filename = expand(<span style="color:#2544bb">"%:t:r"</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">if</span> <span style="color:#2544bb">"# "</span> . filename == first_line
</span></span><span style="display:flex;"><span><span style="color:#505050">        " First line is already correct.</span>
</span></span><span style="display:flex;"><span>        :
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">elseif</span> first_line =~ <span style="color:#2544bb">'^#*\s*\V'</span> . escape(filename, <span style="color:#2544bb">'\'</span>) . <span style="color:#2544bb">'\m\s*$'</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">        " First line matches filename but has wrong header format.</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">        " Reformat to have proper format.</span>
</span></span><span style="display:flex;"><span>        call setline(<span style="color:#0000c0">1</span>, <span style="color:#2544bb">"# "</span> . filename)
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">else</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">        " First line not matching filename at all. Prepend lines with</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">        " filename as a header.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#5317ac">if</span> first_line != <span style="color:#2544bb">""</span>
</span></span><span style="display:flex;"><span>            call append(<span style="color:#0000c0">0</span>, <span style="color:#2544bb">""</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#5317ac">endif</span>
</span></span><span style="display:flex;"><span>        call append(<span style="color:#0000c0">0</span>, <span style="color:#2544bb">"# "</span> . filename)
</span></span><span style="display:flex;"><span>    <span style="color:#5317ac">endif</span>
</span></span><span style="display:flex;"><span><span style="color:#5317ac">endfunction</span></span></span></code></pre>
</div>
</div>
<p>Vim script is pretty weird, had to search in documentation for how to do most things in there. Props to people who write entire programs in it, like let's say <a href="https://github.com/orgs/vimwiki/people">those people that wrote Vimwiki</a>.</p>
<p>Now, to make this run whenever I open a Vimwiki file, or before saving it, I put this in <a href="https://github.com/bkhl/dotfiles/blob/c122d0b5016a9e4cfc29947ff7ecb9741ab4d11e/.vim/plugin/config/vimwiki.vim">my ~/.vim/ftplugin/vimwiki.vim</a>:</p>
<div class="src src-vim">
<div class="highlight">
<pre tabindex="0" style="color:#000;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span><span style="color:#505050">" Set header to match filename when opening or saving file, for</span>
</span></span><span style="display:flex;"><span><span style="color:#505050">" interoperability with Nextcloud Notes.</span>
</span></span><span style="display:flex;"><span>call SetWikiHeader()
</span></span><span style="display:flex;"><span><span style="color:#5317ac">autocmd</span> BufWritePre &lt;buffer&gt; call SetWikiHeader()</span></span></code></pre>
</div>
</div>
<p>The end result is pretty nice. The only big catch is that I can't rename files in Nextcloud Notes if they have a lot of links to them, since those links only get updated if I use the rename function in Vimwiki, but then that's not something I do very often.</p>
</article>
</main>
<footer>
<p>© 2010–2024 Björn Lindström</p>
</footer>
</body>
</html>
